<!DOCTYPE html>
<html lang="en">
  <head>
    <link
      rel="stylesheet"
      href="https://pchaganti.github.io/assets/css/bookshelf.main.css"
    />
    <link
      rel="stylesheet"
      href="https://pchaganti.github.io/assets/css/bookshelf.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+Display:ital,wght@0,100..900;1,100..900&family=Roboto+Condensed:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />

    <style>
      .loading {
        text-align: center;
        padding: 20px;
      }

      .year-nav {
        display: flex;
        gap: 10px;
        margin: 20px 0;
        flex-wrap: wrap;
      }

      .year-btn {
        padding: 8px 16px;
        border: none;
        background: #eee;
        cursor: pointer;
        border-radius: 4px;
      }

      .year-btn.active {
        background: #333;
        color: white;
      }

      .book-count {
        font-size: 0.9em;
        color: #666;
        margin-left: 10px;
      }

      .search-box {
        width: 100%;
        max-width: 300px;
        padding: 8px;
        margin: 20px 0;
      }

      .retry-btn {
        padding: 8px 16px;
        background: #dc3545;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }

      .bookshelf {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        padding: 20px;
      }

      .book {
        width: 150px; /* Standard book cover width */
        height: 225px; /* 3:2 aspect ratio */
        margin: 10px;
        position: relative;
        transition: transform 0.3s ease;
      }

      .cover {
        width: 100%;
        height: 100%;
        background-size: cover;
        background-position: center;
        border-radius: 4px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      /* Remove unused styles */
      .spine,
      .spine-title,
      .spine-author,
      .top,
      .spine-patterns,
      .spine-colors {
        display: none;
      }

      /* Optional hover effect */
      .book:hover {
        transform: translateY(-5px);
      }
    </style>
  </head>

  <body>
    <main>
      <h1 id="my-bookshelf">pchaganti | biblio</h1>
      <h4 style="font-style: italic">
        A man ought to read just as inclination leads him; for what he reads as
        a task will do him little good - Samuel Johnson, 1742
      </h4>
      <input
        type="search"
        class="search-box"
        placeholder="Search books..."
        id="searchBox"
      />
      <div class="year-nav" id="yearNav"></div>
      <div id="books-container"></div>
      <br />
      <script>
        async function loadBooks() {
          const years = ["2024", "2023"];
          const container = document.getElementById("books-container");
          const yearNav = document.getElementById("yearNav");
          
          container.innerHTML = '<div class="loading">Loading books...</div>';
          yearNav.innerHTML = '';

          // Create navigation buttons
          years.forEach((year, index) => {
              const btn = document.createElement("button");
              btn.className = "year-btn";
              btn.textContent = year;
              btn.onclick = () => filterByYear(year);
              // Set active state for first year
              if (index === 0) btn.classList.add('active');
              yearNav.appendChild(btn);
          });

          for (const year of years) {
              try {
                  const response = await fetch(`books/${year}.html`);
                  const html = await response.text();
                  
                  const yearSection = document.createElement("div");
                  yearSection.dataset.year = year;
                  yearSection.style.marginTop = "32px";
                  // Hide all years except first
                  yearSection.style.display = year === years[0] ? 'block' : 'none';
                  
                  const yearHeader = document.createElement("h2");
                  yearHeader.className = "yearRead";
                  
                  yearSection.insertAdjacentHTML('beforeend', html);
                  const bookCount = yearSection.querySelectorAll('.book').length;
                  
                  yearHeader.textContent = year;
                  const countSpan = document.createElement("span");
                  countSpan.className = "book-count";
                  countSpan.textContent = ` (${bookCount} books)`;
                  yearHeader.appendChild(countSpan);
                  
                  yearSection.insertBefore(yearHeader, yearSection.firstChild);
                  container.appendChild(yearSection);
              } catch (error) {
                  console.error(`Error loading ${year}:`, error);
              }
          }

          container.querySelector('.loading')?.remove();
        }

        // Single event listener
        document.addEventListener("DOMContentLoaded", loadBooks);

        function filterByYear(year) {
          document.querySelectorAll('.year-btn').forEach(btn => 
              btn.classList.toggle('active', btn.textContent === year));
          
          document.querySelectorAll('[data-year]').forEach(section => 
              section.style.display = section.dataset.year === year ? 'block' : 'none');
        }

        function searchBooks(query) {
          const normalizedQuery = query.toLowerCase();
          document.querySelectorAll('.book').forEach(book => {
              const title = book.dataset.title?.toLowerCase() || '';
              const author = book.dataset.author?.toLowerCase() || '';
              book.style.display = 
                  title.includes(normalizedQuery) || 
                  author.includes(normalizedQuery) ? 'block' : 'none';
          });
        }
      </script>
    </main>
    <br /><br /><br />
  </body>
</html>
